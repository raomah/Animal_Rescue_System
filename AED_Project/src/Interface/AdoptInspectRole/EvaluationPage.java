/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Interface.AdoptInspectRole;

import Business.Adopt.AdoptHistory;
import Business.Adopt.AdoptionOffered;
import Business.Adopt.AdoptRecord;
import Business.Animals.AnimalDetails;
import Business.Date.Date;
import Business.Deliver.DeliveryHistoryDetails;
import Business.Enterprises.RescueCenterEntDetails;
import Interface.AdoptorRole.MyAdoptPage;
import java.awt.CardLayout;
import java.awt.Component;
import javax.swing.JOptionPane;
import javax.swing.JPanel;

/**
 *
 * @author user
 */
public class EvaluationPage extends javax.swing.JPanel {

    /**
     * Creates new form EvaluationPage
     */
    
    private JPanel container;
    private RescueCenterEntDetails enterprise;
    private AdoptRecord ar;
    
    EvaluationPage(JPanel container, RescueCenterEntDetails enterprise, AdoptRecord ar) {
        initComponents();
        this.container = container;
        this.enterprise = enterprise;
        this.ar = ar;
        rbtnApprove.setSelected(true);
        txtMessage.setEnabled(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btnPrevious = new javax.swing.JButton();
        lblEvaluateApp = new javax.swing.JLabel();
        lblResult = new javax.swing.JLabel();
        lblReason = new javax.swing.JLabel();
        rbtnApprove = new javax.swing.JRadioButton();
        rbtnReject = new javax.swing.JRadioButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        txtMessage = new javax.swing.JTextArea();
        btnSubmit = new javax.swing.JButton();
        lblDeliveryDate = new javax.swing.JLabel();
        txtYear = new javax.swing.JTextField();
        txtMonth = new javax.swing.JTextField();
        txtDate = new javax.swing.JTextField();
        lblYear = new javax.swing.JLabel();
        lblMonth = new javax.swing.JLabel();
        lblDate = new javax.swing.JLabel();

        btnPrevious.setText("Previous");
        btnPrevious.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPreviousActionPerformed(evt);
            }
        });

        lblEvaluateApp.setFont(new java.awt.Font("Tahoma", 1, 24)); // NOI18N
        lblEvaluateApp.setText("Evaluate Applicant :");

        lblResult.setFont(new java.awt.Font("宋体", 0, 16)); // NOI18N
        lblResult.setText("Result:");

        lblReason.setFont(new java.awt.Font("宋体", 0, 16)); // NOI18N
        lblReason.setText("Reason:");

        rbtnApprove.setFont(new java.awt.Font("宋体", 0, 14)); // NOI18N
        rbtnApprove.setText("Approve");
        rbtnApprove.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbtnApproveActionPerformed(evt);
            }
        });

        rbtnReject.setFont(new java.awt.Font("宋体", 0, 14)); // NOI18N
        rbtnReject.setText("Reject");
        rbtnReject.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rbtnRejectActionPerformed(evt);
            }
        });

        txtMessage.setColumns(20);
        txtMessage.setRows(5);
        txtMessage.setEnabled(false);
        jScrollPane1.setViewportView(txtMessage);

        btnSubmit.setFont(new java.awt.Font("宋体", 0, 14)); // NOI18N
        btnSubmit.setText("Submit");
        btnSubmit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSubmitActionPerformed(evt);
            }
        });

        lblDeliveryDate.setFont(new java.awt.Font("宋体", 0, 16)); // NOI18N
        lblDeliveryDate.setText("Delivery Date:");

        lblYear.setText("YYYY");

        lblMonth.setText("MM");

        lblDate.setText("DD");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(189, 189, 189)
                        .addComponent(lblEvaluateApp))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(84, 84, 84)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblDeliveryDate)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(lblResult)
                                .addComponent(lblReason)))
                        .addGap(40, 40, 40)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(rbtnApprove)
                                .addGap(28, 28, 28)
                                .addComponent(rbtnReject))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(txtYear, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblYear)
                                .addGap(8, 8, 8)
                                .addComponent(txtMonth, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblMonth)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtDate, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lblDate))
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(btnPrevious))
                .addContainerGap(148, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(btnSubmit)
                .addGap(238, 238, 238))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblEvaluateApp)
                .addGap(49, 49, 49)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblResult)
                    .addComponent(rbtnApprove)
                    .addComponent(rbtnReject))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblDeliveryDate)
                    .addComponent(txtYear, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtMonth, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtDate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblYear)
                    .addComponent(lblMonth)
                    .addComponent(lblDate))
                .addGap(28, 28, 28)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lblReason)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(28, 28, 28)
                .addComponent(btnSubmit, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 55, Short.MAX_VALUE)
                .addComponent(btnPrevious)
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btnPreviousActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPreviousActionPerformed
        // TODO add your handling code here:
        container.remove(this);
        Component[] componentArray = container.getComponents();
        Component component = componentArray[componentArray.length - 1];
        CheckInspectInfo sidjp = (CheckInspectInfo) component;
        sidjp.populateButton();
        CardLayout layout = (CardLayout)container.getLayout();
        layout.previous(container);
    }//GEN-LAST:event_btnPreviousActionPerformed

    private void btnSubmitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSubmitActionPerformed
        // TODO add your handling code here:
        if(rbtnApprove.isSelected() == true) {
            if(!txtYear.getText().matches("\\d{4}")) {
                JOptionPane.showMessageDialog(null, "Year is invalid");
                return;
            }
            if(txtYear.getText().matches("\\d{4}")) {
                if(Integer.parseInt(txtYear.getText()) < 2016) {
                    JOptionPane.showMessageDialog(null, "Year is invalid");
                    return;
                }
            }
            if(!txtMonth.getText().matches("\\d{1,2}")){
                JOptionPane.showMessageDialog(null, "Month is invalid");
                return;
            }
            if(txtMonth.getText().matches("\\d{1,2}")) {
                if(Integer.parseInt(txtMonth.getText()) > 12 
                        || Integer.parseInt(txtMonth.getText()) <= 0 ) {
                    JOptionPane.showMessageDialog(null, "Month is invalid");
                    return;
                }
                else if(Integer.parseInt(txtYear.getText()) == 2016
                         && Integer.parseInt(txtMonth.getText()) < 12) {
                    JOptionPane.showMessageDialog(null, "Month is invalid");
                    return;
                }
            }
            if(!txtDate.getText().matches("\\d{1,2}")){
                JOptionPane.showMessageDialog(null, "Date is invalid");
                return;
            }
            if(txtDate.getText().matches("\\d{1,2}")) {
                if(Integer.parseInt(txtDate.getText()) > 31
                        || Integer.parseInt(txtDate.getText()) <= 0 ) {
                    JOptionPane.showMessageDialog(null, "Date is invalid");
                    return;
                }
                else if(Integer.parseInt(txtYear.getText()) == 2016
                         && Integer.parseInt(txtMonth.getText()) == 12
                        && Integer.parseInt(txtDate.getText()) < 16) {
                    JOptionPane.showMessageDialog(null, "Date is invalid");
                    return;
                }
            }
        }
        
        if(rbtnReject.isSelected() == true) {
            if(txtMessage.getText().equals("")) {
                JOptionPane.showMessageDialog(null, "Please fill out the reason for rejection.");
                return;
            }
        }
        
        if(rbtnApprove.isSelected() == true) {
            ar.setStatus(AdoptRecord.APPROVED_STATUS);
            int size = ar.getAdoptorName().getHistoryDirectory().getHistoryList().size();
            ar.getAdoptorName().getHistoryDirectory().getHistoryList().get(size-1).setStatus(AdoptHistory.APPROVED_STATUS);
            ar.getAnimal().setAnimalstatus(AnimalDetails.ADOPTED_STATUS);
            DeliveryHistoryDetails dh = new DeliveryHistoryDetails();
            dh.setAdoptername(ar.getAdoptorName());
            dh.setAnimal(ar.getAnimal());
            dh.setStatus(DeliveryHistoryDetails.WAITING_STATUS);

            int year = Integer.parseInt(txtYear.getText());
            int month = Integer.parseInt(txtMonth.getText());
            int date = Integer.parseInt(txtDate.getText());
            Date d = new Date();
            d.setYear(year);
            d.setMonth(month);
            d.setDate(date);
            dh.setDate(d);
            enterprise.getDeliveryHistoryDirectory().addDeliveryHistory(dh);
        }
        else if(rbtnReject.isSelected() == true) {
            ar.setStatus(AdoptRecord.REJECTED_STATUS);
            int size = ar.getAdoptorName().getHistoryDirectory().getHistoryList().size();
            ar.getAdoptorName().getHistoryDirectory().getHistoryList().get(size-1).setMessage(txtMessage.getText());
            ar.getAdoptorName().getHistoryDirectory().getHistoryList().get(size-1).setStatus(AdoptHistory.REJECTED_STATUS);
            for(AdoptionOffered ao: enterprise.getAdoptionList().getAdoptionOfferingList()) {
                if(ao.getAnimal() == ar.getAnimal()) {
                    ao.setStatus(AdoptionOffered.OPEN_STATUS);
                }
            }
        }
        
        btnSubmit.setVisible(false);
        JOptionPane.showMessageDialog(null, "Evaluated Successfully.\nResult has been sent.");
        
    }//GEN-LAST:event_btnSubmitActionPerformed

    private void rbtnApproveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbtnApproveActionPerformed
        // TODO add your handling code here:
        rbtnReject.setSelected(false);
        txtMessage.setEnabled(false);
        txtYear.setEnabled(true);
        txtMonth.setEnabled(true);
        txtDate.setEnabled(true);
    }//GEN-LAST:event_rbtnApproveActionPerformed

    private void rbtnRejectActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rbtnRejectActionPerformed
        // TODO add your handling code here:
        rbtnApprove.setSelected(false);
        txtMessage.setEnabled(true);
        txtYear.setEnabled(false);
        txtMonth.setEnabled(false);
        txtDate.setEnabled(false);
    }//GEN-LAST:event_rbtnRejectActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnPrevious;
    private javax.swing.JButton btnSubmit;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblDate;
    private javax.swing.JLabel lblDeliveryDate;
    private javax.swing.JLabel lblEvaluateApp;
    private javax.swing.JLabel lblMonth;
    private javax.swing.JLabel lblReason;
    private javax.swing.JLabel lblResult;
    private javax.swing.JLabel lblYear;
    private javax.swing.JRadioButton rbtnApprove;
    private javax.swing.JRadioButton rbtnReject;
    private javax.swing.JTextField txtDate;
    private javax.swing.JTextArea txtMessage;
    private javax.swing.JTextField txtMonth;
    private javax.swing.JTextField txtYear;
    // End of variables declaration//GEN-END:variables
}
